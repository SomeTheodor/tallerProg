programa parcialC
procesos
  proceso enviarIntento(E intento:boolean)
  comenzar
    EnviarMensaje(intento,r1)
    EnviarMensaje(intento,r2)
    EnviarMensaje(intento,r3)
  fin
  proceso enviarEsquina
  variables
    id,av,ca:numero
  comenzar
    Random(id,1,3)
    Random(av,40,60)
    Random(ca,40,60)
    si(id = 1)
      EnviarMensaje(id,r1)
      EnviarMensaje(av,r1)
      EnviarMensaje(ca,r1)
    sino
      si(id = 2)
        EnviarMensaje(id,r2)
        EnviarMensaje(av,r2)
        EnviarMensaje(ca,r2)
      sino
        EnviarMensaje(id,r3)
        EnviarMensaje(av,r3)
        EnviarMensaje(ca,r3) 
  fin
  proceso recibirEsquina(E id:numero)
  variables
    idFis,av,ca:numero
  comenzar
    RecibirMensaje(idFis,rF)
    si(id = idFis)
      RecibirMensaje(av,rF)
      RecibirMensaje(ca,rF)
      verEsquina(av,ca)
  fin
  proceso verEsquina(E av:numero; E ca:numero;)
  variables
    avAct,caAct:numero
  comenzar
    avAct:= PosAv
    caAct:= PosCa
    BloquearEsquina(av,ca)
    Pos(av,ca)
    mientras HayFlorEnLaEsquina
      tomarFlor
    Pos(avAct,caAct)
    LiberarEsquina(av,ca)
  fin
  proceso dejarFlores
  variables
    av,ca:numero
  comenzar
    av:=PosAv
    ca:=PosCa
    BloquearEsquina(10,10)
    Pos(10,10)
    depositarFlor
    Pos(av,ca)
    LiberarEsquina(10,10)
  fin
  proceso contarFlores(ES cant:numero)
  comenzar
    av:=PosAv
    ca:=PosCa
    Pos(10,10)
    mientras HayFlorEnLaEsquina
      tomarFlor
      cant:= cant + 1
    mientras HayFlorEnLaBolsa
      depositarFlor
    Pos(av,ca)
  fin
areas
  c1: AreaP (1,1,1,1)
  c2: AreaP (2,1,2,1)
  c3: AreaP (3,1,3,1)
  cF: AreaP (4,1,4,1)
  dep: AreaC (10,10,10,10)
  ciudad: AreaPC (40,40,60,60)
robots
  robot fiscal
  variables
    cant:numero
    ok:boolean
  comenzar
    EnviarMensaje(1,r1)
    EnviarMensaje(2,r2)
    EnviarMensaje(3,r3)
    repetir 8
      enviarEsquina
      enviarIntento(true)
    enviarIntento(false)
    repetir 3
      RecibirMensaje(ok,*)
    contarFlores(cant)
    Informar('Cant de flores', cant)    
  fin
  robot florero
  variables
    id:numero
    intento,ok:boolean
  comenzar
    RecibirMensaje(id,rF)
    intento:=true
    mientras (intento = true)
      recibirEsquina(id)
      RecibirMensaje(intento,rF)
    mientras HayFlorEnLaBolsa
      dejarFlores
    ok:=true
    EnviarMensaje(ok,rF)
  fin
variables
  r1: florero
  r2: florero
  r3: florero
  rF: fiscal
comenzar
  AsignarArea(r1, c1)
  AsignarArea(r2, c2)
  AsignarArea(r3, c3)
  AsignarArea(rF, cF)
  AsignarArea(r1, dep)
  AsignarArea(r2, dep)
  AsignarArea(r3, dep)
  AsignarArea(rF, dep)
  AsignarArea(r1, ciudad)
  AsignarArea(r2, ciudad)
  AsignarArea(r3, ciudad)
  Iniciar(r1, 1,1)
  Iniciar(r2, 2,1)
  Iniciar(r3, 3,1)
  Iniciar(rF, 4,1)
fin
